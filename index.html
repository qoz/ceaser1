<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Caesar Cipher Solver</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: system-ui, sans-serif;
      margin: 0;
      padding: 16px;
      background: #111;
      color: #f5f5f5;
    }

    h1 {
      font-size: 1.4rem;
      margin-bottom: 8px;
      text-align: center;
    }

    .section {
      margin-bottom: 16px;
    }

    .label {
      font-size: 0.9rem;
      opacity: 0.8;
      margin-bottom: 4px;
    }

    textarea, input[type="text"] {
      width: 100%;
      box-sizing: border-box;
      padding: 8px;
      border-radius: 8px;
      border: 1px solid #444;
      background: #222;
      color: #f5f5f5;
      font-size: 0.95rem;
      resize: vertical;
    }

    textarea {
      min-height: 60px;
    }

    .cipher-text, .plain-text {
      padding: 12px;
      border-radius: 8px;
      background: #222;
      min-height: 48px;
      font-size: 1.1rem;
      word-wrap: break-word;
      white-space: pre-wrap;
    }

    .cipher-text {
      border: 1px solid #444;
    }

    .plain-text {
      border: 1px solid #2a6;
    }

    #mappings {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      justify-content: center;
    }

    .map-btn {
      min-width: 60px;
      min-height: 50px;
      padding: 4px 6px;
      font-size: 0.9rem;
      border-radius: 6px;
      border: 1px solid #555;
      background: #222;
      color: #f5f5f5;
      touch-action: manipulation;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    .letter {
      font-weight: bold;
      font-size: 1rem;
    }

    .count {
      font-size: 0.75rem;
      opacity: 0.7;
      margin-top: -2px;
    }

    .arrow {
      opacity: 0.7;
      margin: 0 2px;
    }

    .target {
      font-weight: bold;
      color: #7cf;
      font-size: 1rem;
    }

    .controls {
      display: flex;
      justify-content: center;
      gap: 8px;
      margin-top: 12px;
      flex-wrap: wrap;
    }

    button.big-btn {
      padding: 10px 16px;
      font-size: 1rem;
      border-radius: 999px;
      border: none;
      background: #2a6;
      color: #fff;
      touch-action: manipulation;
    }

    button.big-btn.secondary {
      background: #444;
    }

    #message {
      text-align: center;
      margin-top: 8px;
      min-height: 20px;
      font-size: 0.95rem;
    }

    #message.ok {
      color: #7cfb7c;
    }

    #message.err {
      color: #ff8d8d;
    }

    #loadBtn {
      margin-top: 8px;
      width: 100%;
    }
  </style>
</head>
<body>
  <h1>Caesar Cipher Solver</h1>

  <div class="section">
    <div class="label">Enter encrypted message:</div>
    <textarea id="cipherInput" placeholder="Paste or type the encrypted text here..."></textarea>

    <div class="label" style="margin-top:8px;">
      (Optional) Enter known solution text for checking:
    </div>
    <input id="solutionInput" type="text"
           placeholder="If you know the plaintext, enter it here for 'Check Solution'..." />

    <button id="loadBtn" class="big-btn">Load Message</button>
  </div>

  <div class="section">
    <div class="label">Encrypted message:</div>
    <div id="cipher" class="cipher-text"></div>
  </div>

  <div class="section">
    <div class="label">Your decryption:</div>
    <div id="plain" class="plain-text"></div>
  </div>

  <div class="section">
    <div class="label">Tap a letter to set its replacement:</div>
    <div id="mappings"></div>
  </div>

  <div class="controls">
    <button id="checkBtn" class="big-btn">Check Solution</button>
    <button id="clearBtn" class="big-btn secondary">Clear Mappings</button>
  </div>

  <div id="message"></div>

  <script>
    const alphabet = "ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("");

    const cipherEl = document.getElementById("cipher");
    const plainEl = document.getElementById("plain");
    const mappingsEl = document.getElementById("mappings");
    const messageEl = document.getElementById("message");
    const checkBtn = document.getElementById("checkBtn");
    const clearBtn = document.getElementById("clearBtn");
    const loadBtn = document.getElementById("loadBtn");
    const cipherInput = document.getElementById("cipherInput");
    const solutionInput = document.getElementById("solutionInput");

    let cipherText = "";
    let solutionText = "";

    const mapping = {};
    alphabet.forEach(l => mapping[l] = "");

    function decodeText() {
      let decoded = "";

      for (const ch of cipherText) {
        const up = ch.toUpperCase();
        if (alphabet.includes(up)) {
          const rep = mapping[up];
          decoded += rep ? rep : "_";
        } else {
          decoded += ch;
        }
      }

      plainEl.textContent = decoded;
    }

    // Only show letters in cipherText + show counts
    function renderMappings() {
      mappingsEl.innerHTML = "";
      if (!cipherText) return;

      // Count letter frequencies
      const freq = {};
      alphabet.forEach(l => freq[l] = 0);
      for (const ch of cipherText.toUpperCase()) {
        if (alphabet.includes(ch)) freq[ch]++;
      }

      const usedLetters = Object.keys(freq).filter(l => freq[l] > 0).sort();

      usedLetters.forEach(letter
