<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Caesar Cipher Solver</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h1>Caesar Cipher Solver</h1>

  <!-- Manual entry section -->
  <div class="section">
    <div class="label">Enter encrypted message:</div>
    <textarea id="cipherInput" placeholder="Paste or type the encrypted text here..."></textarea>

    <div class="label" style="margin-top:8px;">
      (Optional) Enter known solution text for checking:
    </div>
    <input id="solutionInput" type="text"
           placeholder="If you know the plaintext, enter it here for 'Check Solution'..." />

    <button id="loadBtn" class="big-btn">Load Message</button>
  </div>

  <!-- Encrypted text display -->
  <div class="section">
    <div class="label">Encrypted message:</div>
    <div id="cipher" class="cipher-text"></div>
  </div>

  <!-- Decoded output -->
  <div class="section">
    <div class="label">Your decryption:</div>
    <div id="plain" class="plain-text"></div>
  </div>

  <!-- Letter substitution UI -->
  <div class="section">
    <div class="label">Tap a letter to set its replacement:</div>
    <div id="mappings"></div>
  </div>

  <!-- Frequency view -->
  <div class="section">
    <div class="label">Frequency view (most common letters first):</div>
    <div id="freqView"></div>
  </div>

  <!-- Controls -->
  <div class="controls">
    <button id="checkBtn" class="big-btn">Check Solution</button>
    <button id="clearBtn" class="big-btn secondary">Clear Mappings</button>
  </div>

  <!-- Status display -->
  <div id="message"></div>

  <script>
    const alphabet = "ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("");

    const cipherEl       = document.getElementById("cipher");
    const plainEl        = document.getElementById("plain");
    const mappingsEl     = document.getElementById("mappings");
    const messageEl      = document.getElementById("message");
    const checkBtn       = document.getElementById("checkBtn");
    const clearBtn       = document.getElementById("clearBtn");
    const loadBtn        = document.getElementById("loadBtn");
    const cipherInput    = document.getElementById("cipherInput");
    const solutionInput  = document.getElementById("solutionInput");
    const freqViewEl     = document.getElementById("freqView");

    let cipherText   = "";
    let solutionText = "";

    // Mapping dictionary: cipher letter â†’ guessed plaintext letter
    const mapping = {};
    alphabet.forEach(l => mapping[l] = "");

    function computeFrequencies() {
      const freq = {};
      alphabet.forEach(l => freq[l] = 0);
      for (const ch of cipherText.toUpperCase()) {
        if (alphabet.includes(ch)) freq[ch]++;
      }
      return freq;
    }

    function decodeText() {
      let decoded = "";

      for (const ch of cipherText) {
        const up = ch.toUpperCase();
        if (alphabet.includes(up)) {
          const rep = mapping[up];
          decoded += rep ? rep : "_";
        } else {
          decoded += ch;
        }
      }

      plainEl.textContent = decoded;
    }

    function renderMappings() {
      mappingsEl.innerHTML = "";
      freqViewEl.innerHTML = "";

      if (!cipherText) return;

      const freq = computeFrequencies();
      const usedLetters = Object.keys(freq).filter(l => freq[l] > 0);

      // Mapping buttons (alphabetical)
      const usedAlphabetical = usedLetters.slice().sort();

      usedAlphabetical.forEach(letter => {
        const btn = document.createElement("button");
        btn.className = "map-btn";

        btn.innerHTML =
          `<span class="letter">${letter}</span>` +
          `<span class="count">${freq[letter]}</span>` +
          `<span class="arrow">â†’</span>` +
          `<span class="target">${mapping[letter] || "_"}</span>`;

        btn.addEventListener("click", () => {
          const current = mapping[letter] || "";
          const input = prompt(
            \`Replace ${letter} with (leave empty to clear):\`,
            current
          );

          if (input === null) return;

          const trimmed = input.trim().toUpperCase();
          const newChar = trimmed[0] || "";

          // Clearing substitution
          if (!newChar) {
            mapping[letter] = "";
            renderMappings();
            decodeText();
            return;
          }

          // Check for duplicates (prevent same plaintext used twice)
          const conflict = alphabet.find(
            l => mapping[l] === newChar && l !== letter
          );

          if (conflict) {
            const ok = confirm(
              \`'${newChar}' is already used for '${conflict}'.\\nUse it for '${letter}' instead?\`
            );
            if (!ok) return;

            mapping[conflict] = "";
          }

          mapping[letter] = newChar;

          renderMappings();
          decodeText();
        });

        mappingsEl.appendChild(btn);
      });

      // Frequency view (sorted by descending frequency)
      const sortedFreq = usedLetters.slice().sort((a, b) => freq[b] - freq[a]);

      sortedFreq.forEach(letter => {
        const div = document.createElement("div");
        div.className = "freq-item";
        div.innerHTML =
          `<span class="freq-letter">${letter}</span>` +
          `<span class="freq-count">${freq[letter]}</span>`;
        freqViewEl.appendChild(div);
      });
    }

    function resetMappings() {
      alphabet.forEach(l => mapping[l] = "");
      renderMappings();
      decodeText();
    }

    // Load message manually
    loadBtn.addEventListener("click", () => {
      cipherText   = (cipherInput.value || "").trim();
      solutionText = (solutionInput.value || "").trim();

      if (!cipherText) {
        messageEl.textContent = "Please enter an encrypted message.";
        messageEl.className   = "err";
        cipherEl.textContent  = "";
        plainEl.textContent   = "";
        freqViewEl.innerHTML  = "";
        mappingsEl.innerHTML  = "";
        return;
      }

      cipherEl.textContent = cipherText;
      messageEl.textContent =
        solutionText ?
          "Message loaded. Start mapping letters or check the solution." :
          "Message loaded. Start mapping letters.";
      messageEl.className = "";

      resetMappings();
    });

    checkBtn.addEventListener("click", () => {
      if (!cipherText) {
        messageEl.textContent = "Load a message first.";
        messageEl.className = "err";
        return;
      }

      if (!solutionText) {
        messageEl.textContent = "No solution text provided.";
        messageEl.className = "err";
        return;
      }

      const target = solutionText.replace(/\s+/g, "").toUpperCase();
      const guess = plainEl.textContent
        .replace(/_/g, "")
        .replace(/\s+/g, "")
        .toUpperCase();

      if (guess === target && guess.length > 0) {
        messageEl.textContent = "ðŸŽ‰ Correct! You solved it!";
        messageEl.className = "ok";
      } else {
        messageEl.textContent = "Not quite yetâ€”keep trying!";
        messageEl.className = "err";
      }
    });

    clearBtn.addEventListener("click", () => {
      resetMappings();
      messageEl.textContent = "";
      messageEl.className = "";
    });

    // Initial empty render
    renderMappings();
    decodeText();
  </script>
</body>
</html>
